# 酒店管理数据分析

## 客户信息

+ 客户编号（主键）
+ 姓名
+ 性别
+ 身份证号
+ 联系方式
+ 预订方式（电话/网站）

## 酒店信息

+ 酒店编号（主键）
+ 酒店名
+ 地址
+ 联系方式
+ 酒店剩余房间数（初始值为600）

## 房间信息

+ 房间编号（主键）
+ 房间号
+ 房间类型（单人床、双人床、豪华套间、商务套间）
+ 房间价格
+ 房间属性（true/flase）
+ 酒店编号（外键）

## 支付信息

+ 支付单号（主键）
+ 支付价格
+ 支付方式
+ 支付状态（未支付/已支付）
+ 支付时间
+ 客户编号（外键）

## 预订信息

+ 预订编号（主键）
+ 预订起始时间
+ 预订时长
+ 客户编号（外键）
+ 房间编号（外键）

## 管理人员信息

+ 管理人员编号（主键）
+ 姓名
+ 职位
+ 酒店编号（外键）

# 数据字典

## 客户表

|列名| 列名说明   | 数据类型    |是否为空| 键        |默认值|其它|
|------| -------- | ----------- |------| ----------- |------|-----|
|cid| 客户编号 | varchar(25) |否| primary key |null|null|
|cname| 姓名     | varchar(20) |否|             |null|null|
|csex| 性别     | char(1)    | 否 |             |null|null|
|cid_card| 身份证号 | varchar(20) |否|             |null|unique|
|cphone_number| 联系方式 | varchar(15) |否|             |null|unique|
|bookmethod| 预订方式 | varchar(20) |否|     |null|check('电话预订'，'网上预定')|

## 酒店表

|列名| 列名说明   | 数据类型    |是否为空| 键        |默认值|其它|
|------| -------- | ----------- |------| ----------- |------|-----|
|hid| 酒店编号     | varchar(15) | 否 |primary key          |null|null|
|hname| 酒店名       | varchar(20) | 否 |             |null|null|
|haddress| 酒店地址     | varchar(50) | 否 |             |null|null|
|hphone_number| 酒店联系方式 | varchar(15) | 否 |             |null|null|
|hroom_number| 酒店房间总数 | samllint    | 否 |             |600|null|

## 房间表

|列名| 列名说明   | 数据类型    |是否为空| 键        |默认值|其它|
|------| -------- | ----------- |------| ----------- |------|-----|
|rid| 房间编号 | varchar(15)  | 否            |primary key|null|null|
|rnum| 房间号   | varchar(5)   | 否                ||null|null|
|rtype| 房间类型 | varchar(15)  | 否                ||null|check('单人房','双人房','豪华套间','商务套间')|
|rprice| 房间价格 | decimal(8,2) | 否       ||null|null|
|rf| 房间属性 | varchar(1)   | 否 ||‘0’|check('0','1')|
|rhid| 酒店编号 | varchar(15)  | 否       |foreign key|null|null|


## 管理员表

|列名| 列名说明   | 数据类型    |是否为空| 键        |默认值|其它|
|------| -------- | ----------- |------| ----------- |------|-----|
|aid| 管理员编号 | varchar(15) | 否 |primary key |null|null|
|aname| 姓名       | varchar(20) |否|             |null|null|
|apost| 职位       | varchar(15) |否|             |null|null|
|ahid| 酒店编号   | varchar(15) |否| foreign key |null|null|

## 支付信息表

|列名| 列名说明   | 数据类型    |是否为空| 键        |默认值|其它|
|------| -------- | ----------- |------| ----------- |------|-----|
|pid| 支付单号 | varchar(25)  |否| primary key              |null|null|
|pprice| 支付价格 | decimal(8,2) |否|                  |null|null|
|pway| 支付方式 | varchar(10)  |否|             |null|check('微信','支付宝','银行卡')|
|pstate| 支付状态 | varchar(1)   |否|  |'0'|null|
|ptime| 支付时间 | datetime     |否|             |null|null|
|pcid|客户编号|varchar(25)|否|foreign key|null|null|

## 预定表

|列名| 列名说明   | 数据类型    |是否为空| 键        |默认值|其它|
|------| -------- | ----------- |------| ----------- |------|-----|
|bid| 预定编号     | varchar(25) | 否 |primary key              |null|null|
|bstart_time| 预订起始时间 | datetime    | 否 |             |null|null|
|blength| 预订时长     | smallint    | 否 |             |null|null|
|bcid| 客户编号     | varchar(25) | 否 |foreign key              |null|null|
|brid| 房间编号     | varchar(15) | 否 |foreign key |null|null|

# 注解

+ 对视图的解释：
  + 为了方便查看订单，所以创建订单视图（包含了客户姓名，预订房间号，支付方式，支付时间，支付价格等信息）
  + 为了方便查看客户预订的时间的详细信息，所以创建了预定时间视图（包含了预订开始时间，预订时长，预定结束时间等信息）
+ 对触发器的解释：
  1. 当插入一条预订信息时，会自动按照预订信息里的房间信息将房间所在酒店的剩余房间数-1，并且修改该房间的房间属性
  2. 当删除一条预订信息时，会自动删除该预订信息对应的客户信息和支付信息，并修改房间信息所对的房间属性，并将该房间所在的酒店的剩余房间数+1
+ 对于房间信息表解释：
  + 考虑到不同的酒店的房间号可能一样，所以单独列出了房间编号

  + 房间状态：
    + 1：表示该房间已被预订
    + 0：表示该房间空闲

  + 房间类型：酒店只提供四种房间：单人房、双人房、豪华套间、商务套间
+ 对于预订信息表的解释：
  + `blength`：表示预订房间时长，以小时(h)为单位
  + `bstart_time`：表示房间预订的起始时间
+ 对于支付信息表的解释：
  + 支付状态：
    + 0：表示待支付
    + 1：表示已支付

  + 支付方式：只支持三种支付方式：微信、支付宝、银行卡
+ 对酒店信息表的解释：
  + `hroom_number`：表示该酒店剩余房间的房间数量，并默认每个酒店一共有600间房
+ 对于索引的解释：
  + 对客户表中的客户姓名和客户的身份证号建立联合唯一索引，方便在客户入住时前台查询客户相关信息
+ 对表中数据类型的解释：
  + 由于考虑到该酒店集团在全国各地的酒店的房间数最多为36000间，由这些房间而产生的订单数据量会更多，所以未采用int类型作为各个表的主键的数据类型，反而采用了可变类型varchar可以存储更多的信息
  + 对于预订信息表中的房间预定时长，由于房间预订时长以小时为单位，smallint的范围为：0 ~ 65535，最多大概7 ~ 8年，tinyint的范围为：0~255，最多是10天左右，故我们采用smallint类型存储
  + 对于房间信息表中的房间属性（有人入住，空闲）和支付信息表中的支付状态（待支付，支付成功），这两个字段只存在两种情况，故使用0,1来表示，并用varchar类型来存储
  + 对于房间信息表中的房间价格和支付信息表中的支付价格，这两个字段需要精确的数字，所以使用定点数类型存储

# 后期优化建议

+ 对于索引：
  + 后期可以根据查询语句中将使用最频繁的字段设为索引，可以提高查询效率
+ 对于视图：
  + 后期可以根据查询较为频繁的字段，将这些字段连接起来创建一个视图，方便之后的查询
+ 对于触发器：
  + 由于触发器的设置对代码的可读性会造成影响，并且不利于调试，所以后期尽量不要过多的触发触发器
  + 对于`book_hotel_room_number_delete`触发器，后期建议修改该触发器的内容，使其只具有修改房间属性和酒店剩余房间数的功能，而将删除客户表数据、删除支付表数据这两个功能放在代码层面来实现。
+ 对于存储函数：
  + 虽然存储函数和存储结构封装性更好，还可以降低开发工作量，但其可移植性较差，调试困难，并且不适合高并发的情景，所以要尽量少的创建存储函数和存储过程
  + 但是为了方便测试数据库，可以创建一些存储函数来实现插入数据可删除数据，这样在后期使用JDBC连接MySQL数据库进行测试的时候方便向表中插入和删除数据，减少了代码量。

