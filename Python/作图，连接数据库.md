# 作图

## plt

```python
import pandas as pd  # 做表格处理
from pyecharts.charts import Bar
from pyecharts.charts import Line, Page
from pyecharts import options as opts

data_df = pd.read_csv('F:\\source\\Python\\WorkSpace\\BasicCode\\python_project\\project1\\data.csv')
df = data_df.dropna()
df1 = df[['股票名称', '成交量', '成交额']]
df2 = df[['股票名称', '涨跌额', '涨跌幅', '年初至今']]

bar1 = (
    Bar()
    .add_xaxis(df1['股票名称'].values.tolist())
    .add_yaxis("股票成交量", df1['成交量'].values.tolist())
    .set_series_opts(label_opts=opts.LabelOpts(is_show=False))  # 隐藏数值标签
    .set_global_opts(
        datazoom_opts=opts.DataZoomOpts(),
    )
)

bar2 = (
    Bar()
    .add_xaxis(df1['股票名称'].values.tolist())
    .add_yaxis("成交额", df1['成交额'].values.tolist())
    .set_series_opts(label_opts=opts.LabelOpts(is_show=False))  # 隐藏数值标签
    .set_global_opts(
        datazoom_opts=opts.DataZoomOpts(),
    )
)

line = (
    Line()
    .add_xaxis(df2['股票名称'].values.tolist())
    .add_yaxis("涨跌额", df2['涨跌额'].values.tolist())
    .add_yaxis("涨跌幅", y_axis=df2['涨跌幅'].values.tolist())
    .add_yaxis("年初至今", y_axis=df2['年初至今'].values.tolist())
    .set_global_opts(
        datazoom_opts=opts.DataZoomOpts(),
    )
)

page = (
    Page(
        layout=Page.DraggablePageLayout
    )
    .add(bar1)
    .add(bar2)
    .add(line)
).render('data.html')

```

## pyecharts

```python
# 绘制真实值和预测值的误差曲线图
from pyecharts.charts import Bar
from pyecharts import options as opts
from pyecharts.charts import Pie
from pyecharts.render import make_snapshot
from snapshot_selenium import snapshot
import numpy as np

real_data=data['Close'] # 真实值
predict_data=res.ravel() # 预测值

# 计算误差
error=predict_data-real_data

# 计算平均绝对误差
mae=np.mean(np.abs(error))

# 计算均方根误差
rmse=np.mean(np.mean(error**2))

# 绘制误差柱状图
bar=(
    Bar()
    .add_xaxis(data['Date'].tolist())
    .add_yaxis("日误差",error.tolist(),
              markpoint_opts=opts.MarkPointOpts(data=[opts.MarkPointItem(type_='max')]),)
    .set_series_opts(label_opts=opts.LabelOpts(is_show=False)) # 隐藏数值标签
    .set_global_opts(title_opts=opts.TitleOpts(title='预测误差'), 
                     datazoom_opts=opts.DataZoomOpts(is_show=True)
    )
)

# # 绘制月误差玫瑰饼图
# 将原始数据按每22个数据进行分组，并计算每组的平均值
grouped_data = []
for i in range(0, len(error), 22):
    group = error[i:i+22]
    group_mean = np.mean(group)
    grouped_data.append(group_mean)

# 创建玫瑰饼状图的数据，使用新的平均值数据
pie_data = []
dates = data['Date'].tolist()[21::22]
for x, y in zip(dates, grouped_data):
    pie_data.append((x, y))

# 创建玫瑰饼状图
pie = (
    Pie()
    .add(
        series_name="误差",
        data_pair=pie_data,
        radius=["30%", "90%"],  # 设置玫瑰饼状图的半径范围
        rosetype="radius",  # 设置玫瑰饼状图的类型为'radius'
        label_opts=opts.LabelOpts(formatter="{b}: {c}",is_show=False),
    )
    .set_global_opts(
        title_opts=opts.TitleOpts(title='预测月误差'),
        legend_opts=opts.LegendOpts(is_show=False),  # 隐藏图例
    )
)

page=(
    Page(
        layout=Page.DraggablePageLayout
    )
    .add(kline)
    .add(line1)
    .add(line2)
    .add(bar)
    .add(pie)
).render('data.html')

# 输出预测准确度指标
print('平均绝对误差（MAE）:', mae)
print('均方根误差（RMSE）:', rmse)
```

# 连接数据库

```python
# 连接mysql数据库，将爬取到的数据文件的中的数据存储到test数据库的stock表中
import mysql.connector
from mysql.connector import Error
import csv

# 获取数据库连接
try:
    conn = mysql.connector.connect(
        host='127.0.0.1',
        user='root',
        password='Lhb@327515',
        database='test'
    )
    if conn.is_connected():
        print('Connected to MySQL database success')
except Error as e:
    print(e)

cursor = conn.cursor()

# 将文件中的数据插入到数据库中
insert_query = """
INSERT IGNORE INTO stock (`Date`, `Open`, `High`, `Low`, `Close`, `Adj_Close`, `Volume`)
VALUES (%s, %s, %s, %s, %s, %s, %s)
"""

try:
    with open('data.csv', 'r') as file:
        csv_data = csv.reader(file)
        next(csv_data)  # 跳过标题行
        for row in csv_data:
            cursor.execute(insert_query, (row[0], row[1], row[2], row[3], row[4], row[5], row[6]))
    conn.commit()
    print('Data inserted successfully')
except Error as e:
    print(e)

# 关闭数据库连接
conn.close()
```

```python
#读取mysql数据库中的数据
import pandas as pd
import mysql.connector

# 建立与MySQL数据库的连接
conn = mysql.connector.connect(
    host='127.0.0.1',
    user='root',
    password='Lhb@327515',
    database='test'
)

# 创建一个MySQL数据库查询
query = "SELECT * FROM stock"

# 使用pandas的read_sql函数从MySQL数据库中读取数据
data = pd.read_sql(query, conn)

# 关闭数据库连接
conn.close()

# 打印DataFrame的内容
print(data)
```

